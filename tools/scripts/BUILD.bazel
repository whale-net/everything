# Utility scripts for the monorepo

load("@rules_python//python:defs.bzl", "py_binary")

package(default_visibility = ["//visibility:public"])

exports_files([
    "analyze_layer_caching.sh",
    "get_app_changes.sh",
    "get_binary_name.sh",
    "get_deps_hash.sh",
    "sync_generated_clients.sh",
    "test_cross_compilation.sh",
])

# Cross-compilation verification test
# Verifies that multiplatform images contain correct architecture-specific wheels
sh_test(
    name = "test_cross_compilation",
    size = "large",
    timeout = "long",
    srcs = ["test_cross_compilation.sh"],
    data = [
        "//demo/hello_fastapi:hello-fastapi_image",
    ],
    tags = [
        "image-integration",  # Image integration test for container architecture verification
        "integration",  # Integration test, not unit test
        "manual",  # Don't run with //...
        "no-cache",  # Always run, never cache
    ],
)

# Version resolver utility for Helm charts
py_binary(
    name = "version_resolver",
    srcs = ["version_resolver.py"],
    main = "version_resolver.py",
    visibility = ["//visibility:public"],
)
