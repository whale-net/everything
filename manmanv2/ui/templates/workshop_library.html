{{define "workshop_library_content"}}
<style>
.hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 40px; border-radius: 12px; margin-bottom: 30px; text-align: center; }
.hero h2 { font-size: 36px; margin-bottom: 15px; }
.hero p { font-size: 18px; opacity: 0.9; }
.quick-links { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
.quick-link { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; cursor: pointer; transition: transform 0.2s; }
.quick-link:hover { transform: translateY(-4px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
.quick-link-icon { font-size: 48px; margin-bottom: 15px; }
.library-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-top: 20px; }
.library-card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s; }
.library-card:hover { transform: translateY(-4px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
.library-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
.library-title { font-size: 20px; font-weight: 600; color: #1f2937; }
.library-count { background: #e0e7ff; color: #3730a3; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
.addon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
.addon-card { background: #f9fafb; padding: 20px; border-radius: 6px; border-left: 4px solid #2563eb; }
.addon-title { font-weight: 600; color: #1f2937; margin-bottom: 8px; }
.addon-meta { display: flex; justify-content: space-between; font-size: 12px; color: #9ca3af; margin-top: 10px; }
</style>

<div class="hero">
    <h2>ðŸŽ® Workshop Library</h2>
    <p>Discover & Manage Workshop Content</p>
</div>

<div class="quick-links">
    <div class="quick-link" onclick="document.getElementById('createLibraryModal').style.display='flex'">
        <div class="quick-link-icon">ðŸ“š</div>
        <h3>Create Library</h3>
        <p>Curated collections</p>
    </div>
    <div class="quick-link" onclick="document.getElementById('addAddonModal').style.display='flex'">
        <div class="quick-link-icon">ðŸ§©</div>
        <h3>Add Addon</h3>
        <p>From Steam Workshop</p>
    </div>
    <div class="quick-link" onclick="document.getElementById('gameFilter').focus()">
        <div class="quick-link-icon">ðŸŽ¯</div>
        <h3>Filter by Game</h3>
        <p>Find game-specific content</p>
    </div>
</div>

<h2>Libraries</h2>
{{if .Libraries}}
<div class="library-grid">
    {{range .Libraries}}
    <a href="/workshop/library-detail?library_id={{.LibraryId}}" class="library-card" style="text-decoration: none; color: inherit;">
        <div class="library-header">
            <h3 class="library-title">{{.Name}}</h3>
            <span class="library-count">{{len .AddonIds}} addons</span>
        </div>
        <p style="color: #6b7280; font-size: 14px; margin-bottom: 15px;">{{.Description}}</p>
        <div class="addon-meta">
            <span>{{range $.Games}}{{if eq .GameId $.GameId}}{{.Name}}{{end}}{{end}}</span>
            <form method="POST" action="/workshop/delete-library" style="display: inline;" onclick="event.stopPropagation();">
                <input type="hidden" name="library_id" value="{{.LibraryId}}">
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this library?')">Delete</button>
            </form>
        </div>
    </a>
    {{end}}
</div>
{{else}}
<div class="empty-state" style="text-align: center; padding: 60px 20px; color: #9ca3af;">
    <div style="font-size: 64px; margin-bottom: 20px;">ðŸ“š</div>
    <h3>No libraries yet</h3>
    <p>Create one to organize your addons!</p>
    <button onclick="showModal('createLibraryModal')" class="btn btn-primary" style="margin-top: 15px;">Create Library</button>
</div>
{{end}}

<h2>All Addons</h2>

<div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <label style="font-weight: 600; margin-right: 10px;">Filter by Game:</label>
    <select id="gameFilter" onchange="filterAddons()" style="padding: 8px 12px; border-radius: 4px; border: 1px solid #d1d5db;">
        <option value="">All Games</option>
        {{range .Games}}
        <option value="{{.GameId}}">{{.Name}}</option>
        {{end}}
    </select>
</div>

{{if .Addons}}
<div class="addon-grid">
    {{range .Addons}}
    <div class="addon-card" data-game-id="{{.GameId}}">
        <h4 class="addon-title">{{.Name}}</h4>
        <div style="background: #f3f4f6; padding: 8px 12px; border-radius: 4px; font-size: 12px; color: #4b5563; margin: 10px 0;">
            Workshop ID: {{.WorkshopId}}
        </div>
        <div class="addon-meta">
            <span>{{range $.Games}}{{if eq .GameId $.GameId}}{{.Name}}{{end}}{{end}}</span>
            <span>
                {{if .FileSizeBytes}}{{printf "%.1f" (divf .FileSizeBytes 1048576)}} MB{{else}}-{{end}}
            </span>
        </div>
        <div style="margin-top: 12px;">
            {{if .IsCollection}}
            <span style="background: #e0e7ff; color: #3730a3; padding: 4px 8px; border-radius: 4px; font-size: 11px;">Collection</span>
            {{else}}
            <span style="background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 11px;">Addon</span>
            {{end}}
        </div>
        <form method="POST" action="/workshop/delete-addon" style="margin-top: 12px;">
            <input type="hidden" name="addon_id" value="{{.AddonId}}">
            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this addon?')">Delete</button>
        </form>
    </div>
    {{end}}
</div>
{{else}}
<div class="empty-state" style="text-align: center; padding: 60px 20px; color: #9ca3af;">
    <div style="font-size: 64px; margin-bottom: 20px;">ðŸ§©</div>
    <h3>No addons found</h3>
    <p>Add one to get started!</p>
    <button onclick="showModal('addAddonModal')" class="btn btn-primary" style="margin-top: 15px;">Add Addon</button>
</div>
{{end}}

<!-- Add Addon Modal -->
<div id="addAddonModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Fetch Addon from Steam</h2>
            <button onclick="hideModal('addAddonModal')" class="btn-close">&times;</button>
        </div>
        <form hx-post="/workshop/fetch-metadata" hx-target="#fetchResult">
            <div class="form-group">
                <label>Game:</label>
                <select name="game_id" required>
                    {{range .Games}}
                    <option value="{{.GameId}}">{{.Name}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group">
                <label>Workshop ID:</label>
                <input type="text" name="workshop_id" required placeholder="e.g., 2938285337">
            </div>
            <div class="form-group">
                <label>Platform:</label>
                <select name="platform_type" required>
                    <option value="steam_workshop">Steam Workshop</option>
                </select>
            </div>
            <div id="fetchResult"></div>
            <div class="modal-footer">
                <button type="button" onclick="hideModal('addAddonModal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Fetch Metadata</button>
            </div>
        </form>
    </div>
</div>

<!-- Create Library Modal -->
<div id="createLibraryModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Create Library</h2>
            <button onclick="hideModal('createLibraryModal')" class="btn-close">&times;</button>
        </div>
        <form method="POST" action="/workshop/create-library">
            <div class="form-group">
                <label>Game:</label>
                <select name="game_id" required>
                    {{range .Games}}
                    <option value="{{.GameId}}">{{.Name}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" name="name" required placeholder="e.g., Essential Mods">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea name="description" rows="3" placeholder="Optional description"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="hideModal('createLibraryModal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Library</button>
            </div>
        </form>
    </div>
</div>

<script>
function showModal(id) {
    document.getElementById(id).style.display = 'flex';
}

function hideModal(id) {
    document.getElementById(id).style.display = 'none';
}

function filterAddons() {
    const gameId = document.getElementById('gameFilter').value;
    const cards = document.querySelectorAll('.addon-card');
    
    cards.forEach(card => {
        if (!gameId || card.dataset.gameId === gameId) {
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    });
}
</script>
{{end}}
