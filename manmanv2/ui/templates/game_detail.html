{{define "game_detail_content"}}
<div class="action-bar">
    <h1>{{.Game.Name}}</h1>
    <div>
        <a href="/games/{{.Game.GameId}}/actions" class="btn btn-primary btn-sm">
            <i class="fa fa-bolt"></i> Manage Actions
        </a>
        <button class="btn btn-secondary btn-sm" onclick="document.getElementById('edit-form').style.display='block'">Edit</button>
        <button class="btn btn-danger btn-sm"
                hx-delete="/games/{{.Game.GameId}}/delete"
                hx-confirm="Are you sure you want to delete this game?">Delete</button>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div class="card-title">Game Information</div>
    </div>
    <dl style="display: grid; grid-template-columns: 200px 1fr; gap: 0.5rem;">
        <dt><strong>Game ID:</strong></dt>
        <dd>{{.Game.GameId}}</dd>
        
        <dt><strong>Name:</strong></dt>
        <dd>{{.Game.Name}}</dd>
        
        <dt><strong>Steam App ID:</strong></dt>
        <dd>{{if .Game.SteamAppId}}{{.Game.SteamAppId}}{{else}}-{{end}}</dd>
        
        {{if .Game.Metadata}}
        <dt><strong>Genre:</strong></dt>
        <dd>{{if .Game.Metadata.Genre}}{{.Game.Metadata.Genre}}{{else}}-{{end}}</dd>
        
        <dt><strong>Publisher:</strong></dt>
        <dd>{{if .Game.Metadata.Publisher}}{{.Game.Metadata.Publisher}}{{else}}-{{end}}</dd>
        
        <dt><strong>Tags:</strong></dt>
        <dd>
            {{if .Game.Metadata.Tags}}
                {{range .Game.Metadata.Tags}}
                <span class="badge badge-secondary">{{.}}</span>
                {{end}}
            {{else}}-{{end}}
        </dd>
        {{end}}
    </dl>
</div>

<!-- Edit form (hidden by default) -->
<div id="edit-form" style="display: none;">
    <div class="card">
        <div class="card-header">
            <div class="card-title">Edit Game</div>
        </div>
        <form hx-post="/games/{{.Game.GameId}}/edit" hx-swap="none">
            <div class="form-group">
                <label for="name">Name *</label>
                <input type="text" id="name" name="name" value="{{.Game.Name}}" required>
            </div>
            
            <div class="form-group">
                <label for="steam_app_id">Steam App ID</label>
                <input type="text" id="steam_app_id" name="steam_app_id" value="{{.Game.SteamAppId}}">
            </div>
            
            <div class="form-group">
                <label for="genre">Genre</label>
                <input type="text" id="genre" name="genre" value="{{if .Game.Metadata}}{{.Game.Metadata.Genre}}{{end}}">
            </div>
            
            <div class="form-group">
                <label for="publisher">Publisher</label>
                <input type="text" id="publisher" name="publisher" value="{{if .Game.Metadata}}{{.Game.Metadata.Publisher}}{{end}}">
            </div>
            
            <div class="form-group">
                <label for="tags">Tags (comma-separated)</label>
                <input type="text" id="tags" name="tags" value="{{if .Game.Metadata}}{{range $i, $tag := .Game.Metadata.Tags}}{{if $i}}, {{end}}{{$tag}}{{end}}{{end}}">
            </div>
            
            <div style="display: flex; gap: 0.5rem;">
                <button type="submit" class="btn btn-success">Save Changes</button>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('edit-form').style.display='none'">Cancel</button>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div class="card-title">Addon Path Presets</div>
    </div>
    <div class="card-content">
        <p style="color: #666; margin-bottom: 1rem;">
            Define reusable installation paths for workshop addons. Presets help avoid re-entering the same path for similar addons (e.g., maps, plugins).
        </p>
        {{if .PathPresets}}
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Volume</th>
                    <th>Installation Path</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {{range .PathPresets}}
                <tr>
                    <td><strong>{{.Name}}</strong>{{if .Description}}<br><small style="color: #666;">{{.Description}}</small>{{end}}</td>
                    <td>
                        {{if .VolumeId}}
                            {{$vol := index $.Volumes .VolumeId}}
                            {{if $vol}}{{$vol.Name}} <small style="color: #666;">({{$vol.ContainerPath}})</small>{{else}}<em>Volume #{{.VolumeId}}</em>{{end}}
                        {{else}}<em>(first volume)</em>{{end}}
                    </td>
                    <td><code>{{.InstallationPath}}</code></td>
                    <td>
                        <form method="POST" action="/games/{{$.Game.GameId}}/presets/{{.PresetId}}/delete" style="display: inline;">
                            <input type="hidden" name="preset_id" value="{{.PresetId}}">
                            <input type="hidden" name="game_id" value="{{$.Game.GameId}}">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Delete this preset?')">Delete</button>
                        </form>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
        {{else}}
        <div class="empty-state">
            <p>No path presets defined. Add a preset to make addon installation easier.</p>
        </div>
        {{end}}
        <div style="margin-top: 1rem;">
            <button class="btn btn-primary btn-sm" onclick="document.getElementById('add-preset-form').style.display='block'">+ Add Preset</button>
        </div>
    </div>
</div>

<!-- Add Preset Form (hidden by default) -->
<div id="add-preset-form" style="display: none;">
    <div class="card">
        <div class="card-header">
            <div class="card-title">Add Path Preset</div>
        </div>
        <form method="POST" action="/games/{{.Game.GameId}}/presets/create">
            <input type="hidden" name="game_id" value="{{.Game.GameId}}">

            <div class="form-group">
                <label for="preset_name">Name *</label>
                <input type="text" id="preset_name" name="name" required placeholder="e.g., Maps, Plugins, Skins">
                <small>Short label for this preset (e.g., "Maps", "SourceMod Plugins")</small>
            </div>

            <div class="form-group">
                <label for="preset_description">Description</label>
                <textarea id="preset_description" name="description" rows="2" placeholder="Optional description of what addons use this path"></textarea>
            </div>

            <div class="form-group">
                <label for="preset_volume_id">Volume (Optional)</label>
                <select id="preset_volume_id" name="volume_id">
                    <option value="">-- Use first volume (default) --</option>
                    {{range .Volumes}}
                    <option value="{{.VolumeId}}">{{.Name}} ({{.ContainerPath}})</option>
                    {{end}}
                </select>
                <small>Select which volume addons using this preset should install to</small>
            </div>

            <div class="form-group">
                <label for="preset_installation_path">Installation Path *</label>
                <input type="text" id="preset_installation_path" name="installation_path" required placeholder="e.g., left4dead2/maps/">
                <small>Relative path within the volume (e.g., "addons/sourcemod/plugins/")</small>
            </div>

            <div style="display: flex; gap: 0.5rem;">
                <button type="submit" class="btn btn-success">Add Preset</button>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('add-preset-form').style.display='none'">Cancel</button>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div class="card-title">Game Configurations</div>
        <a href="/games/{{.Game.GameId}}/configs/new" class="btn btn-sm btn-primary">Create Config</a>
    </div>
    
    {{if .Configs}}
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Docker Image</th>
                <th>SGCs</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .Configs}}
            <tr>
                <td><a href="/games/{{$.Game.GameId}}/configs/{{.ConfigId}}">{{.Name}}</a></td>
                <td><code>{{.Image}}</code></td>
                <td>{{index $.SgcCounts .ConfigId}}</td>
                <td>
                    <a href="/games/{{$.Game.GameId}}/configs/{{.ConfigId}}" class="btn btn-sm btn-primary">View</a>
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <div class="empty-state">
        <p>No configurations yet. Create a configuration to deploy this game.</p>
    </div>
    {{end}}
</div>
{{end}}
